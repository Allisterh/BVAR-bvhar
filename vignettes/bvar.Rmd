---
title: "Introduction to BVAR"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Introduction to BVAR}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  comment = "#>",
  collapse = TRUE,
  out.width = "70%",
  fig.align = "center",
  fig.width = 6,
  fig.asp = .618,
  fig.pos = "H"
  )
options(digits = 3)
```

```{r pkgs}
library(bvhar)
```

```{r addpkgs}
# for this vignette--------------
library(dplyr)
```

# Simple Setting

## ETF Dataset

Among the datasets in this package, we try CBOE ETF volatility index (`etf_vix`).
Aribitrarily, we extract a small number of variables: *Gold, crude oil, euro currency, and china ETF*.

```{r etfdat}
var_idx <- c("GVZCLS", "OVXCLS", "EVZCLS", "VXFXICLS")
etf <- 
  etf_vix %>% 
  select(all_of(var_idx))
etf
```

For out-of-sample forecasting, split the data.
The last `19` observations will be test set.

```{r outofsample}
h <- 19
# train-------------
etf_train <- 
  etf %>% 
  slice(seq_len(n() - h))
# test--------------
etf_test <- setdiff(etf, etf_train)
# dimension---------
m <- ncol(etf)
```

- n: Total number of observation
- p: VAR lag
- m: Dimension of variable
- s = n - p
- k = m * p + 1

# Minnesota Prior

## Fit

```{r bvarlag}
bvar_lag <- 5
```

Simple setting:

```{r minnesotaset}
lam <- .5 # lambda
delta <- rep(1, m) # delta vector
sig <- apply(etf_train, 2, sd) # sigma vector
eps <- 1e-04 # very small number
```

```{r bvarfit}
(fit_bvar <- bvar_minnesota(etf_train, bvar_lag, sig, lam, delta, eps))
```

## Posterior Distribution

```{r}
est_bvar <- gen_posterior(fit_bvar, 500)
```

```{r}
autoplot(est_bvar, "mean", "GVZCLS")
```



## Forecasting

```{r}
(pred_bvar <- predict(fit_bvar, h))
```

```{r}
(mse_bvar <- apply(etf_test - pred_bvar, 2, function(x) mean(x^2)))
```

Compare:

```{r}
# VAR-------------------------
fit_var <- var_lm(etf_train, bvar_lag)
pred_var <- predict(fit_var, h)
mse_var <- apply(etf_test - pred_var, 2, function(x) mean(x^2))
# VHAR------------------------
fit_har <- vhar_lm(etf_train)
pred_har <- predict(fit_har, h)
mse_har <- apply(etf_test - pred_har, 2, function(x) mean(x^2))
# BVHAR-----------------------
fit_bvhar <- bvhar_minnesota(etf_train, sig, lam, delta, eps)
pred_bvhar <- predict(fit_bvhar, h)
mse_bvhar <- apply(etf_test - pred_bvhar, 2, function(x) mean(x^2))
```

MSE:

```{r}
# VAR-------------
mean(mse_var)
# VHAR------------
mean(mse_har)
# BVAR------------
mean(mse_bvar)
# BVHAR-----------
mean(mse_bvhar)
```

# Ghosh Prior

## Fit

```{r}
set.seed(1)
U <- runif(1, 0, 10) * diag(m * bvar_lag + 1) # c * I
(fit_ghosh <- bvar_ghosh(etf_train, bvar_lag, U))
```

## Forecasting

```{r}
(pred_ghosh <- predict(fit_ghosh, h))
```

```{r}
(mse_ghosh <- apply(etf_test - pred_ghosh, 2, function(x) mean(x^2)))
```

```{r}
# VAR-------------
mean(mse_var)
# VHAR------------
mean(mse_har)
# Minnesota-------
mean(mse_bvar)
# BVHAR-----------
mean(mse_bvhar)
# Ghosh-----------
mean(mse_ghosh)
```



